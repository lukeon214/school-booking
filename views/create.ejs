<h1>Create a New Form</h1>

<form method="POST" action="/create" onsubmit="return handleSubmit()">
  <input name="title" placeholder="Form Title" required><br><br>

  <label>Who can fill this form?</label><br>
  <select name="private">
    <option value="0">Anyone (Public)</option>
    <option value="1">Only logged-in users</option>
  </select><br><br>

  <hr><br>

  <h3>Fields</h3>
  <div id="fields-container"></div>
  <button type="button" class="form-btn" onclick="addField()">+ Add Field</button>

  <br><br>
  <input type="hidden" name="fieldsJSON" id="fieldsJSON">
  <button type="submit" class="form-btn primary">âœ… Publish Form</button>
</form>

<script>
  let fields = [];

  function addField() {
    const index = fields.length;
    const field = {
      label: '',
      type: 'text',
      choices: [],
      maxResponses: null
    };
    fields.push(field);
    renderFields();
  }

  function removeField(i) {
    fields.splice(i, 1);
    renderFields();
  }

  function renderFields() {
    const container = document.getElementById('fields-container');
    container.innerHTML = '';

    fields.forEach((field, i) => {
      const wrapper = document.createElement('div');
      wrapper.className = 'card';

      wrapper.innerHTML = `
        <label>Label</label>
        <input type="text" value="${field.label || ''}" oninput="fields[${i}].label = this.value">

        <label>Type</label>
        <select onchange="updateType(${i}, this.value)">
          <option value="text" ${field.type === 'text' ? 'selected' : ''}>Text</option>
          <option value="dropdown" ${field.type === 'dropdown' ? 'selected' : ''}>Dropdown</option>
          <option value="choice" ${field.type === 'choice' ? 'selected' : ''}>Choice (Radio)</option>
        </select>

        <div id="choices-${i}" style="display: ${field.type === 'dropdown' || field.type === 'choice' ? 'block' : 'none'}">
          <label>Choices (comma-separated)</label>
          <input type="text" value="${field.choices ? field.choices.join(', ') : ''}" oninput="updateChoices(${i}, this.value)">
        </div>

        <label>Max Responses (optional)</label>
        <input type="number" min="0" value="${field.maxResponses || ''}" oninput="fields[${i}].maxResponses = parseInt(this.value) || null">

        <br>
        <button type="button" onclick="removeField(${i})">ðŸ—‘ Remove Field</button>
      `;

      container.appendChild(wrapper);
    });
  }

  function updateChoices(i, text) {
    fields[i].choices = text.split(',').map(x => x.trim()).filter(Boolean);
  }

  function updateType(i, value) {
    fields[i].type = value;
    if (value === 'text') fields[i].choices = [];
    renderFields();
  }

  function handleSubmit() {
    document.getElementById('fieldsJSON').value = JSON.stringify(fields);
    return true;
  }
</script>